<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/dashu.css" />
		<script type="text/javascript" src="./js/jq.js"></script>
	</head>
	<style>
		html,body{
			width: 100%;
			height: 100%;
			margin: 0;
			padding: 0;
			overflow: hidden;
		}
	     #message{
	            margin-top:40px;
	            border:1px solid gray;
	            padding:20px;
	        }
	.mags{
		width: 100px;
		position: absolute;
		line-height: inherit;
		}
		.myimg{
			width: 100%;
			position: absolute;
			left: 0;
			top:0;
			z-index: 1;
		}
		.magscon{
			
			text-align: center;
			position: absolute;
			left: 0;
			top:100%;
			z-index: 10;
		}
	video::-webkit-media-controls-fullscreen-button{ display: none !important; }
	 
	    /*video默认aduio音量按钮*/
	    video::-webkit-media-controls-mute-button { display: none !important;}
	 
	    /*video默认setting按钮*/
	    video::-internal-media-controls-overflow-button{ display: none !important;}
	 
	    /*腾讯云点播禁用firefox全屏、设置按钮*/
	    .trump-button[sub-component="fullscreen_btn"],.trump-button[now="fullscreen"]{ display:none!important;}
	    .trump-button[sub-component="setting"]{ display:none !important;}
	 
	/*禁用video的controls（要慎重！不要轻易隐藏掉，会导致点击视频不能播放）*/
	video::-webkit-media-controls {
	  display:none !important;
	}
	.nonecl{display: none;}
	    </style>
	<body>
		
		<div id="message" style="display: none;" class="nonecl"></div>
		
		</div>
		<div id="container"> 
  <div id="leafContainer">
  </div>  
  <div id="message"> 
  </div>  
  <img src="images/href.png"  style="position: absolute;right: 10%;width: 10%;bottom: 35%;">
</div>  
	</body>
	<script src="./js/dashu.js"></script>
	<script type="text/javascript">
		
		var timeout;
		var timeinte;
		var mytiem;
		var allmsgcon= [];
		var maincontnum=1;
		var defaulmsgcon=  [
			{"name":"韩志国","img":"images/allcon/head/H1/H1 (1).jpg","msg":"防砂治沙路，你我一路同行。"},
			{"name":"吕随启","img":"images/allcon/head/H1/H1 (2).jpg","msg":"一座城，一个家，一个世界，一个梦想"},
			{"name":"许家林","img":"images/allcon/head/H1/H1 (3).jpg","msg":"苍穹白云端，沙漠变绿洲。"},
			{"name":"何维达","img":"images/allcon/head/H1/H1 (4).jpg","msg":"弹指十载去，荒漠变桑田。"},
			{"name":"沈明高","img":"images/allcon/head/H1/H1 (5).jpg","msg":"生态治理功在当代利在千秋。"},
			{"name":"郑风田","img":"images/allcon/head/H1/H1 (6).jpg","msg":"同建绿色温馨家园 共享清澈碧水蓝天。"},
			{"name":"薛兆丰","img":"images/allcon/head/H1/H1 (7).jpg","msg":"保护生态环境，造就秀美山川。"},
			{"name":"朱锡庆","img":"images/allcon/head/H1/H1 (8).jpg","msg":"让生态治理扎根现在 用绿色昭示未来。"},
			{"name":"谢作诗","img":"images/allcon/head/H1/H1 (9).jpg","msg":"生命和绿色拥抱 人类与生态共存。"},
			{"name":"蒋小华","img":"images/allcon/head/H1/H1 (10).jpg","msg":"让绿色和我们一起成长。"},
			{"name":"吴志峰","img":"images/allcon/head/H1/H1 (11).jpg","msg":"共治草原沙化，同享草原诗画。"},
			{"name":"何志毅","img":"images/allcon/head/H1/H1 (12).jpg","msg":"百折不挠，创造绿色奇迹。"},
			{"name":"马　宇","img":"images/allcon/head/H1/H1 (13).jpg","msg":"众志成城，续写大漠传奇。"},
			{"name":"郎咸平","img":"images/allcon/head/H1/H1 (14).jpg","msg":"万众一心共写防沙治沙的绿色传奇。"},
			{"name":"丁志杰","img":"images/allcon/head/H1/H1 (15).jpg","msg":"生态兴则文明兴。"},
		    {"name":"汤　敏","img":"images/allcon/head/H1/H1 (16).jpg","msg":"锲而不舍，绿富同兴"},
			{"name":"谢百三","img":"images/allcon/head/H1/H1 (17).jpg","msg":"增绿增收，治沙治穷"},
			{"name":"孙立坚","img":"images/allcon/head/H1/H1 (18).jpg","msg":"沙患变成沙利，风沙变成风景，黄沙变成黄金"}];                 
		var defmsgindex=0; 
			show();
			function show(){
				
				timeinte=window.setInterval(function(){
					
					
					var fornum;
					if(allmsgcon.length>0){
						
						if(allmsgcon.length<=allcont.length){
							fornum=allmsgcon.length;
						}else{
							fornum=allcont.length;
						}
							var nowinindex =Math.floor(Math.random()*allcont[0].length);
							var nowinnum =Math.floor(Math.random()*allcont.length);
							for(var j=0;j<fornum;j++){
								var k=(nowinnum+j)%(allmsgcon.length);
								document.getElementById("out"+k+""+nowinindex).style.webkitAnimationName = 'fade';
								document.getElementById("con"+k+""+nowinindex).style.webkitAnimationName= "";
								document.getElementById("con"+k+""+nowinindex).style.webkitAnimationName= "changeshadow";
								document.getElementById("qipao"+k+""+nowinindex).style.webkitAnimationName= "";
								document.getElementById("qipao"+k+""+nowinindex).style.webkitAnimationName= "changeshadow";
								//console.log("co"+k+""+nowinindex);
							}
							mytiem=setTimeout(function(){
								for(var j=0;j<fornum;j++){
									var k=(nowinnum+j)%(allmsgcon.length);
									document.getElementById("con"+k+""+nowinindex).innerHTML=allmsgcon[j].msg;
									document.getElementById("img"+k+""+nowinindex).getElementsByClassName("touxiang")[0].src=allmsgcon[j].img;
									document.getElementById("name"+k+""+nowinindex).innerHTML=allmsgcon[j].name;
									//document.getElementById("con"+fornum+""+nowinindex).style.visibility="visible";
									
								}
								for(var j=0;j<fornum;j++){
									allmsgcon.splice(j,1);
								}
							},3000)
							setTimeout(function(){
								for(var s=0;s<allcont.length;s++){
									for(var k=0;k<allcont[s].length;k++){
										document.getElementById("out"+s+""+k).style.webkitAnimationName = '';
										//document.getElementById("con"+s+""+k).style.webkitAnimationName="";
										//document.getElementById("con"+s+""+k).style.visibility="hidden";
									}
								}	
							},9000)
						
						
					}else if(allmsgcon.length==0){
						//fornum=allcont.length;
						var dropnum =Math.floor(Math.random()*allcont.length);
						var nowinindex =Math.floor(Math.random()*allcont[0].length);
						var numfor;
						
						for(var j=nowinindex;j<(nowinindex+dropnum);j++){
							numfor=(j%allcont.length);
							//console.log("co"+numfor+""+nowinindex);
							document.getElementById("out"+numfor+""+nowinindex).style.webkitAnimationName = 'fade';
							document.getElementById("con"+numfor+""+nowinindex).style.webkitAnimationName= "";
							document.getElementById("con"+numfor+""+nowinindex).style.webkitAnimationName= "changeshadow";
							document.getElementById("qipao"+numfor+""+nowinindex).style.webkitAnimationName= "";
							document.getElementById("qipao"+numfor+""+nowinindex).style.webkitAnimationName= "changeshadow";
							
						}
						mytiem=setTimeout(function(){
							for(var j=nowinindex;j<(nowinindex+dropnum);j++){
								numfor=(j%allcont.length);
								//console.log("co"+numfor+""+nowinindex+""+j);
								var defulenshowindex =Math.floor(Math.random()*defaulmsgcon.length);
								document.getElementById("con"+numfor+""+nowinindex).innerHTML=defaulmsgcon[defulenshowindex].msg;
								document.getElementById("img"+numfor+""+nowinindex).getElementsByClassName("touxiang")[0].src=defaulmsgcon[defulenshowindex].img;
								document.getElementById("name"+numfor+""+nowinindex).innerHTML=defaulmsgcon[defulenshowindex].name;
								//document.getElementById("con"+numfor+""+nowinindex).style.visibility="visible";
								
							}
							
						},3000)
						setTimeout(function(){
						for(var s=0;s<allcont.length;s++){
							for(var k=0;k<allcont[s].length;k++){
								document.getElementById("out"+s+""+k).style.webkitAnimationName = '';
								//document.getElementById("con"+s+""+k).style.webkitAnimationName="";
								//document.getElementById("con"+s+""+k).style.visibility="hidden";
							}
						}	
						},9000)
						
						
					}
				},10000);
			}
		
	    var websocket = null;
		conectWebSocket();
	    function conectWebSocket(){
	    	var nickname = "fist";
	    	if(nickname===""){
	    	    alert("请输入昵称");
	    	    return;
	    	}
	        //判断当前浏览器是否支持WebSocket
	        if ('WebSocket'in window) {
	           // websocket = new WebSocket("ws://localhost:5050/websocket");
	            websocket = new WebSocket("ws:"+window.location.href.split("//")[1].split("/dashu")[0]+"/websocket"+"/qqq"); 
	        } else {
	            alert('Not support websocket');
	        }
	        //连接发生错误的回调方法
	        websocket.onerror = function() {
	            setMessageInnerHTML("error");
	        };
	        //连接成功建立的回调方法
	        websocket.onopen = function(event) {
	            setMessageInnerHTML("Loc MSG: 成功建立连接");
	        }
	        //接收到消息的回调方法
	        websocket.onmessage = function(event) {
	            setMessageInnerHTML(event.data);
	        }
	        //连接关闭的回调方法
	        websocket.onclose = function() {
	            setMessageInnerHTML("Loc MSG:关闭连接");
	        }
	        //监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接，防止连接还没断开就关闭窗口，server端会抛异常。
	        window.onbeforeunload = function() {
	            websocket.close();
	        }
	    }
	    //将消息显示在网页上
	    function setMessageInnerHTML(innerHTML) {
	    	//console.log(typeof(innerHTML));
	    	var mes=innerHTML.split("-!0!-");
			if(mes.length==4){
				if(mes[0]=="1"){
					var mymainmsg={
						name:mes[3],
						msg:mes[1],
						img:mes[2]
					}
					//console.log(mes[2]);
					mainshow(mymainmsg);
					
				}else{
					var myallmsg={
						name:mes[3],
						msg:mes[1],
						img:mes[2]
					}
					console.log(mes[3]);
					allmsgcon.push(myallmsg);
				}
					
				
			}
	    }
		
	    //关闭连接
	    function closeWebSocket() {
	        websocket.close();
	    }
	    //发送消息
	    /*function send() {
	        var message = document.getElementById('text').value;
	        websocket.send(message);
	    }*/
	  //发送消息
	    function send() {
	        //获取输入的文本信息进行发送
	        var message = document.getElementById('text').value;
	        var toUser = document.getElementById('toUser').value;
	        var socketMsg = {msg:message,toUser:toUser};
	        if(toUser == ''){
	            //群聊.
	            socketMsg.type = 0;
	        }else{
	            //单聊.
	            socketMsg.type = 1;
	        }
	        websocket.send(JSON.stringify(socketMsg));
	    }
		
		function mainshow(myallmsg){
			if(maincontnum>maincont.length){maincontnum=1;}
				document.getElementById("mainout"+maincontnum+"").style.webkitAnimationName = 'fade';
			mytiem=setTimeout(function(){
					document.getElementById("mainname"+maincontnum+"").src=myallmsg.name;
					document.getElementById("maincon"+maincontnum+"").src=myallmsg.msg;
					if(myallmsg.img=="defaultimg"){
						document.getElementById("mainhead"+maincontnum+"").src="images/dashu/defpic.png";
					}else{
						document.getElementById("mainhead"+maincontnum+"").src=myallmsg.img;
					}
					
					
			},1000)
			setTimeout(function(){
			document.getElementById("mainout"+maincontnum+"").style.webkitAnimationName = '';
			maincontnum++;
			},6000)
			
		}
	</script>
</html>
